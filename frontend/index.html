<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeLapse-Manager</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <h1>TimeLapse-Manager</h1>
            </div>
            <div class="nav-links">
                <a href="#" data-view="jobs" class="nav-link active">Jobs</a>
                <a href="#" data-view="videos" class="nav-link">Timelapses</a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Jobs View -->
            <div id="jobs-view" class="view active">
                <div class="view-header">
                    <h2>Jobs</h2>
                    <button class="btn btn-primary" onclick="showCreateJobModal()">+ Create Job</button>
                </div>
                <div id="jobs-list" class="jobs-grid"></div>
            </div>

            <!-- Timelapses View -->
            <div id="videos-view" class="view">
                <div class="view-header">
                    <h2>Timelapses</h2>
                </div>
                <div id="videos-list" class="videos-grid"></div>
            </div>
        </main>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="notification-toast">
        <span id="notification-message"></span>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Confirm Action</h3>
            </div>
            <div style="padding: 1.5rem;">
                <p id="confirm-message" style="margin-bottom: 1.5rem;"></p>
                <div id="confirm-options" style="margin-bottom: 1.5rem; display: none;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="delete-captures-checkbox" style="cursor: pointer;">
                        <span>Also delete all capture files from disk</span>
                    </label>
                </div>
                <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeConfirmModal(false)">Cancel</button>
                    <button class="btn btn-danger" onclick="closeConfirmModal(true)">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Job Modal -->
    <div id="create-job-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Create Timelapse Job</h3>
                <span class="close" onclick="closeModal('create-job-modal')">&times;</span>
            </div>
            <form id="create-job-form" onsubmit="createJob(event)">
                <div class="form-group">
                    <label>Job Name *</label>
                    <input type="text" id="job_name" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>Stream URL *</label>
                    <input type="text" id="job_url" class="form-control" placeholder="http:// or rtsp://" required>
                    <input type="hidden" id="stream_type" value="http">
                </div>

                <div class="form-group">
                    <button type="button" class="btn btn-secondary" onclick="testUrl()">Test URL</button>
                    <div id="test-result" class="test-result"></div>
                </div>

                <div class="form-row">
                    <div class="form-group flex-1">
                        <label>Start Date & Time *</label>
                        <input type="datetime-local" id="start_datetime" class="form-control" required>
                    </div>
                    <div class="form-group flex-1">
                        <label>End Date & Time</label>
                        <input type="datetime-local" id="end_datetime" class="form-control">
                        <small>Leave empty for ongoing capture</small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group flex-1">
                        <label>Capture Interval (seconds) *</label>
                        <input type="number" id="interval_seconds" class="form-control" min="10" value="60" required onchange="updateDurationEstimate()">
                        <small>Minimum 10 seconds</small>
                    </div>
                    <div class="form-group flex-1">
                        <label>Target Framerate *</label>
                        <input type="number" id="framerate" class="form-control" min="1" max="120" value="30" required onchange="updateDurationEstimate()">
                    </div>
                </div>

                <div class="duration-estimate" id="duration-estimate"></div>

                <div class="form-group">
                    <label>Capture Path</label>
                    <input type="text" id="capture_path" class="form-control" placeholder="Leave empty for default">
                </div>

                <div class="form-group">
                    <label>Capture Naming Pattern</label>
                    <input type="text" id="naming_pattern" class="form-control" placeholder="Leave empty for default">
                    <small>Available: {job_name}, {num:06d}, {timestamp}</small>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('create-job-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Job Details Modal -->
    <div id="job-details-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="job-details-title">Job Details</h3>
                <span class="close" onclick="closeModal('job-details-modal')">&times;</span>
            </div>
            <div id="job-details-content"></div>
        </div>
    </div>

    <!-- Process Video Modal -->
    <div id="process-video-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Process Timelapse Video</h3>
                <span class="close" onclick="closeModal('process-video-modal')">&times;</span>
            </div>
            <form id="process-video-form" onsubmit="processVideo(event)">
                <input type="hidden" id="process_job_id">
                
                <div class="form-group">
                    <label>Video Name *</label>
                    <input type="text" id="video_name" class="form-control" required>
                </div>

                <div class="form-group">
                    <label>Output Path *</label>
                    <input type="text" id="video_output_path" class="form-control" required>
                    <small>Directory where the video file will be saved</small>
                </div>

                <div class="form-row">
                    <div class="form-group flex-1">
                        <label>Framerate (FPS) *</label>
                        <input type="number" id="video_framerate" class="form-control" min="1" max="120" value="30" required onchange="updateVideoDurationEstimate()">
                    </div>
                    <div class="form-group flex-1">
                        <label>Estimated Duration</label>
                        <div class="duration-estimate" id="video-duration-estimate" style="margin-top: 0.2rem;"></div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group flex-1">
                        <label>Resolution *</label>
                        <select id="video_resolution" class="form-control" required onchange="toggleCustomResolution()">
                            <option value="3840x2160">4K (3840x2160)</option>
                            <option value="1920x1080" selected>Full HD (1920x1080)</option>
                            <option value="1280x720">HD (1280x720)</option>
                            <option value="854x480">SD (854x480)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="form-group flex-1">
                        <label>Quality *</label>
                        <select id="video_quality" class="form-control" required>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high" selected>High</option>
                            <option value="lossless">Lossless</option>
                        </select>
                    </div>
                </div>

                <div id="custom-resolution" class="form-row" style="display: none;">
                    <div class="form-group flex-1">
                        <label>Width (pixels) *</label>
                        <input type="number" id="custom_width" class="form-control" min="1" placeholder="1920">
                    </div>
                    <div class="form-group flex-1">
                        <label>Height (pixels) *</label>
                        <input type="number" id="custom_height" class="form-control" min="1" placeholder="1080">
                    </div>
                </div>

                <div class="form-group">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="use_range">
                        <span>Use custom time range</span>
                    </div>
                </div>

                <div id="capture-range" class="form-row" style="display: none;">
                    <div class="form-group flex-1">
                        <label>Start Time</label>
                        <input type="datetime-local" id="start_time" class="form-control">
                    </div>
                    <div class="form-group flex-1">
                        <label>End Time</label>
                        <input type="datetime-local" id="end_time" class="form-control">
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('process-video-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Video Player Modal -->
    <div id="video-player-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="video-player-title">Video Player</h3>
                <button class="modal-close" onclick="closeVideoPlayer()">&times;</button>
            </div>
            <div style="padding: 1rem;">
                <video id="video-player" controls style="width: 100%; max-height: 70vh; background: #000;">
                    <source id="video-source" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
