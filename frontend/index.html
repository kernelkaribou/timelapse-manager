<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeLapse-Manager</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <h1>TimeLapse-Manager</h1>
            </div>
            <div class="nav-links">
                <a href="#" data-view="jobs" class="nav-link active">Jobs</a>
                <a href="#" data-view="videos" class="nav-link">Timelapses</a>
                <a href="#" data-view="settings" class="nav-link settings-link" title="Settings">
                    <svg width="20" height="20" viewBox="0 0 306.256 306.256" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M282.468,166.157v-26.059l21.313-19.243c2.355-2.126,3.118-5.505,1.903-8.437L289.787,74.04 c-1.214-2.932-4.139-4.774-7.311-4.62l-28.678,1.465l-18.427-18.427l1.465-28.677c0.162-3.169-1.689-6.098-4.62-7.312 L193.837,0.571c-2.933-1.214-6.31-0.452-8.438,1.903l-19.241,21.314h-26.06L120.856,2.474c-2.126-2.355-5.504-3.116-8.437-1.903 L74.04,16.468c-2.932,1.214-4.782,4.143-4.62,7.312l1.465,28.677L52.458,70.884L23.781,69.42 c-3.166-0.157-6.098,1.688-7.312,4.62L0.572,112.419c-1.214,2.932-0.452,6.311,1.903,8.437l21.313,19.242v26.06L2.475,185.4 c-2.355,2.126-3.118,5.505-1.903,8.437l15.897,38.379c1.214,2.932,4.144,4.782,7.312,4.62l28.677-1.465l18.427,18.427 l-1.465,28.677c-0.162,3.169,1.689,6.098,4.62,7.312l38.379,15.897c2.933,1.215,6.311,0.453,8.437-1.903l19.243-21.314h26.06 l19.241,21.314c1.453,1.609,3.489,2.475,5.569,2.475c0.965,0,1.939-0.186,2.868-0.571l38.379-15.897 c2.932-1.214,4.782-4.143,4.62-7.312l-1.465-28.677l18.427-18.427l28.678,1.465c3.175,0.159,6.098-1.689,7.311-4.62 l15.897-38.379c1.215-2.932,0.452-6.311-1.903-8.437L282.468,166.157z M277.955,221.586l-26.721-1.365 c-2.129-0.107-4.186,0.687-5.686,2.187l-23.141,23.141c-1.5,1.501-2.295,3.566-2.186,5.686l1.365,26.72l-28.599,11.846 l-17.929-19.859c-1.423-1.575-3.445-2.474-5.567-2.474h-32.726c-2.122,0-4.145,0.899-5.567,2.474l-17.929,19.859L84.67,277.955 l1.365-26.72c0.108-2.12-0.686-4.186-2.187-5.686l-23.141-23.141c-1.5-1.501-3.561-2.295-5.686-2.187l-26.72,1.365 l-11.846-28.599l19.859-17.929c1.575-1.422,2.474-3.445,2.474-5.567v-32.726c0-2.122-0.899-4.145-2.474-5.567l-19.859-17.929 L28.301,84.67l26.72,1.365c2.123,0.108,4.185-0.686,5.686-2.187l23.141-23.141c1.501-1.5,2.295-3.566,2.187-5.686l-1.365-26.72 l28.599-11.846l17.929,19.859c1.422,1.575,3.445,2.474,5.567,2.474h32.726c2.122,0,4.145-0.899,5.567-2.474l17.929-19.859 l28.599,11.846l-1.365,26.72c-0.108,2.12,0.686,4.186,2.186,5.686l23.141,23.141c1.5,1.5,3.56,2.297,5.686,2.187l26.721-1.365 l11.846,28.599l-19.858,17.929c-1.575,1.422-2.475,3.445-2.475,5.567v32.726c0,2.122,0.899,4.145,2.475,5.567l19.858,17.929 L277.955,221.586z"/>
                        <path d="M153.128,71.045c-45.261,0-82.084,36.822-82.084,82.083s36.822,82.084,82.084,82.084 c45.261,0,82.083-36.822,82.083-82.084C235.211,107.866,198.389,71.045,153.128,71.045z M153.128,220.212 c-36.99,0-67.084-30.094-67.084-67.084s30.094-67.083,67.084-67.083c36.989,0,67.083,30.094,67.083,67.083 S190.118,220.212,153.128,220.212z"/>
                        <path d="M153.128,101.184c-28.642,0-51.944,23.302-51.944,51.944s23.302,51.944,51.944,51.944 c28.643,0,51.944-23.302,51.944-51.944C205.072,124.486,181.771,101.184,153.128,101.184z M153.128,190.072 c-20.371,0-36.944-16.573-36.944-36.944c0-20.371,16.573-36.944,36.944-36.944c20.371,0,36.944,16.573,36.944,36.944 C190.072,173.499,173.499,190.072,153.128,190.072z"/>
                    </svg>
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Jobs View -->
            <div id="jobs-view" class="view active">
                <div class="view-header">
                    <h2>Jobs</h2>
                    <button class="btn btn-purple" onclick="showCreateJobModal()">+ Create Job</button>
                </div>
                <div id="jobs-list" class="jobs-grid"></div>
            </div>

            <!-- Timelapses View -->
            <div id="videos-view" class="view">
                <div class="view-header">
                    <h2>Timelapses</h2>
                </div>
                <div id="videos-list" class="videos-grid"></div>
            </div>

            <!-- Settings View -->
            <div id="settings-view" class="view">
                <div class="view-header">
                    <h2>Settings</h2>
                </div>
                <div class="settings-content">
                    <!-- API Key Section -->
                    <div class="settings-section">
                        <h3>API Key</h3>
                        <p class="settings-description">
                            Use this API key to authenticate external requests to the API. 
                            <a href="/docs" 
                               target="_blank" 
                               class="api-docs-link">
                                View API Documentation
                            </a>
                        </p>
                        <div class="api-key-container">
                            <input type="text" id="api-key-display" class="form-control api-key-input" readonly>
                            <button class="btn btn-secondary" onclick="copyApiKey()">Copy</button>
                            <button class="btn btn-purple" onclick="regenerateApiKey()">Regenerate</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="notification-toast">
        <span id="notification-message"></span>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Confirm Action</h3>
            </div>
            <div style="padding: 1.5rem;">
                <p id="confirm-message" style="margin-bottom: 1.5rem;"></p>
                <div id="confirm-options" style="margin-bottom: 1.5rem; display: none;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="delete-captures-checkbox" style="cursor: pointer;">
                        <span>Also delete all capture files from disk</span>
                    </label>
                </div>
                <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeConfirmModal(false)">Cancel</button>
                    <button class="btn btn-danger" onclick="closeConfirmModal(true)">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Job Modal -->
    <div id="create-job-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Create Timelapse Job</h3>
                <span class="close" onclick="closeModal('create-job-modal')">&times;</span>
            </div>
            <form id="create-job-form" onsubmit="createJob(event)">
                <div class="form-group">
                    <label>Job Name *</label>
                    <input type="text" id="job_name" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>Stream URL *</label>
                    <input type="text" id="job_url" class="form-control" placeholder="http:// or rtsp://" required>
                    <input type="hidden" id="stream_type" value="http">
                </div>

                <div class="form-group">
                    <button type="button" class="btn btn-secondary" onclick="testUrl()">Test URL</button>
                    <div id="test-result" class="test-result"></div>
                </div>

                <div class="form-row">
                    <div class="form-group flex-1">
                        <label>Start Date & Time *</label>
                        <div class="datetime-picker-container">
                            <input type="date" id="start_date" class="form-control" required>
                            <div class="time-part">
                                <select id="start_hour" class="form-control">
                                </select>
                                <span class="separator">:</span>
                                <select id="start_minute" class="form-control">
                                </select>
                            </div>
                        </div>
                        <input type="hidden" id="start_datetime">
                        <small>24-hour format</small>
                    </div>
                    <div class="form-group flex-1">
                        <label>End Date & Time</label>
                        <div class="datetime-picker-container">
                            <input type="date" id="end_date" class="form-control">
                            <div class="time-part">
                                <select id="end_hour" class="form-control">
                                </select>
                                <span class="separator">:</span>
                                <select id="end_minute" class="form-control">
                                </select>
                            </div>
                        </div>
                        <input type="hidden" id="end_datetime">
                        <small>Leave empty for ongoing capture (24-hour format)</small>
                    </div>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="time_window_enabled" style="cursor: pointer;" onchange="toggleTimeWindow()">
                        <span>Enable Daily Time Window</span>
                    </label>
                    <small>Restrict captures to a specific time range each day, otherwise always capture on specified interval</small>
                </div>

                <div id="time-window-fields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group flex-1">
                            <label>Window Start Time *</label>
                            <div class="time-picker-container">
                                <select id="time_window_start_hour" class="form-control">
                                </select>
                                <span class="separator">:</span>
                                <select id="time_window_start_minute" class="form-control">
                                </select>
                            </div>
                            <input type="hidden" id="time_window_start">
                            <small>Start of daily capture window (24-hour format)</small>
                        </div>
                        <div class="form-group flex-1">
                            <label>Window End Time *</label>
                            <div class="time-picker-container">
                                <select id="time_window_end_hour" class="form-control">
                                </select>
                                <span class="separator">:</span>
                                <select id="time_window_end_minute" class="form-control">
                                </select>
                            </div>
                            <input type="hidden" id="time_window_end">
                            <small>End of daily capture window (24-hour, can be next day)</small>
                        </div>
                    </div>
                    <div style="padding: 0.75rem; background: #e3f2fd; border-left: 3px solid #2196f3; margin-bottom: 1rem; border-radius: 0.25rem;">
                        <p style="margin: 0; font-size: 0.875rem; color: #1565c0;">
                            <strong>Note:</strong> The time window can span days. For example, 22:00 to 02:00 will capture from 10 PM to 2 AM.
                        </p>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group flex-1">
                        <label>Capture Interval (seconds) *</label>
                        <input type="number" id="interval_seconds" class="form-control" min="10" value="60" required onchange="updateDurationEstimate()">
                        <small>Minimum 10 seconds</small>
                    </div>
                    <div class="form-group flex-1">
                        <label>Target Framerate *</label>
                        <input type="number" id="framerate" class="form-control" min="1" max="120" value="30" required onchange="updateDurationEstimate()">
                    </div>
                </div>

                <div class="duration-estimate" id="duration-estimate"></div>

                <div class="form-group">
                    <label>Capture Path</label>
                    <input type="text" id="capture_path" class="form-control" placeholder="Leave empty for default">
                </div>

                <div class="form-group">
                    <label>Capture Naming Pattern</label>
                    <input type="text" id="naming_pattern" class="form-control" placeholder="Leave empty for default">
                    <small>Available: {job_name}, {num:06d}, {timestamp}</small>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('create-job-modal')">Cancel</button>
                    <button type="submit" class="btn btn-purple">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Job Details Modal -->
    <div id="job-details-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="job-details-title">Job Details</h3>
                <span class="close" onclick="closeModal('job-details-modal')">&times;</span>
            </div>
            <div id="job-details-content"></div>
        </div>
    </div>

    <!-- Process Video Modal -->
    <div id="process-video-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Process Timelapse Video</h3>
                <span class="close" onclick="closeModal('process-video-modal')">&times;</span>
            </div>
            <form id="process-video-form" onsubmit="processVideo(event)">
                <input type="hidden" id="process_job_id">
                
                <div class="form-group">
                    <label>Video Name *</label>
                    <input type="text" id="video_name" class="form-control" required>
                </div>

                <div class="form-group">
                    <label>Output Path *</label>
                    <input type="text" id="video_output_path" class="form-control" required>
                    <small>Directory where the video file will be saved</small>
                </div>

                <div class="form-row">
                    <div class="form-group flex-1">
                        <label>Framerate (FPS) *</label>
                        <input type="number" id="video_framerate" class="form-control" min="1" max="120" value="30" required onchange="updateVideoDurationEstimate()">
                    </div>
                    <div class="form-group flex-1">
                        <label>Estimated Duration</label>
                        <div class="duration-estimate" id="video-duration-estimate" style="margin-top: 0.2rem;"></div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group flex-1">
                        <label>Resolution *</label>
                        <select id="video_resolution" class="form-control" required onchange="toggleCustomResolution()">
                            <option value="3840x2160">4K (3840x2160)</option>
                            <option value="1920x1080" selected>Full HD (1920x1080)</option>
                            <option value="1280x720">HD (1280x720)</option>
                            <option value="854x480">SD (854x480)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="form-group flex-1">
                        <label>Quality *</label>
                        <select id="video_quality" class="form-control" required>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high" selected>High</option>
                            <option value="lossless">Lossless</option>
                        </select>
                    </div>
                </div>

                <div id="custom-resolution" class="form-row" style="display: none;">
                    <div class="form-group flex-1">
                        <label>Width (pixels) *</label>
                        <input type="number" id="custom_width" class="form-control" min="1" placeholder="1920">
                    </div>
                    <div class="form-group flex-1">
                        <label>Height (pixels) *</label>
                        <input type="number" id="custom_height" class="form-control" min="1" placeholder="1080">
                    </div>
                </div>

                <div class="form-group">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="use_range">
                        <span>Use custom time range</span>
                    </div>
                </div>

                <div id="capture-range" class="form-row" style="display: none;">
                    <div class="form-group flex-1">
                        <label>Start Time</label>
                        <div class="datetime-picker-container">
                            <input type="date" id="video_start_date" class="form-control">
                            <div class="time-part">
                                <select id="video_start_hour" class="form-control">
                                </select>
                                <span class="separator">:</span>
                                <select id="video_start_minute" class="form-control">
                                </select>
                            </div>
                        </div>
                        <input type="hidden" id="start_time">
                        <small>24-hour format</small>
                    </div>
                    <div class="form-group flex-1">
                        <label>End Time</label>
                        <div class="datetime-picker-container">
                            <input type="date" id="video_end_date" class="form-control">
                            <div class="time-part">
                                <select id="video_end_hour" class="form-control">
                                </select>
                                <span class="separator">:</span>
                                <select id="video_end_minute" class="form-control">
                                </select>
                            </div>
                        </div>
                        <input type="hidden" id="end_time">
                        <small>24-hour format</small>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('process-video-modal')">Cancel</button>
                    <button type="submit" id="create-video-btn" class="btn btn-purple">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Video Player Modal -->
    <div id="video-player-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="video-player-title">Video Player</h3>
                <button class="modal-close" onclick="closeVideoPlayer()">&times;</button>
            </div>
            <div style="padding: 1rem;">
                <video id="video-player" controls style="width: 100%; max-height: 70vh; background: #000;">
                    <source id="video-source" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    </div>

    <!-- Maintenance Modal -->
    <div id="maintenance-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 id="maintenance-title">File Maintenance</h3>
                <span class="close" onclick="closeMaintenance()">&times;</span>
            </div>
            <div id="maintenance-content" style="padding: 1.5rem;">
                <!-- Content will be populated dynamically -->
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
